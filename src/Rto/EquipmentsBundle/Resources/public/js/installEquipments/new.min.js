$(document).on("click","#remove",function(){removeEquipment($(this))});
$(document).ready(function(){$("#refer").multiSelect({selectableHeader:"<div class='custom-header'>Staff</div>",selectionHeader:"<div class='custom-header'>Copy to</div>"});$("#serial").autocomplete({source:serials,select:function(b,a){$("#loader-serial").show();searchEquipment(a.item.value)}});$("#form").submit(function(){validation()&&($("#loader-login").show(),$("button[type='submit']").attr("disabled","disabled"),createInstallEquipments($(this).serialize()))});$("#project").change(function(){""!=
$(this).val()&&($("#loader-model").show(),searchLocation($(this).val()))});$("#location").change(function(){""!=$(this).val()&&($("#loader-model").show(),loadDetails($(this).val()))});$("#serial").change(function(){""!=$(this).val()&&5<$(this).val().length&&($("#loader-serial").show(),searchEquipment($(this).val()))});$("#remove").click(function(){removeEquipment($(this))});$("#date").datepicker({dateFormat:"yy-mm-dd"});$("#select-all").click(function(){$("#refer").multiSelect("select_all");return!1});
$("#deselect-all").click(function(){$("#refer").multiSelect("deselect_all");return!1});$("#state").change(function(){1==$(this).val()?($("#notify").show(),$("#notify").next().show()):($("#notify").next().hide(),$("#notify").hide())})});
function searchLocation(b){$("#location").html("<option value=''>Choose..</option>");$.post(addressSearchLocation,"project="+b,function(a){a.state&&(""!=a.type?showMessage(a.type):loadElement($("#location"),a.locations),$("#loader-model").fadeOut("fast"))},"JSON")}
function searchEquipment(b){$.post(addressSearchEquipment,"serial="+b,function(a){a.state&&($("#loader-serial").fadeOut("fast"),""!=a.equipment?-1==elements.indexOf(a.equipment.id)&&(loadEquipment($("#equipments"),a.equipment),showMessage(a.type),$("#serial").val("").focus()):$("#serial").val("").focus(),showMessage(a.type))},"JSON")}
function removeEquipment(b){position=elements.indexOf(b.attr("pk"));elements.splice(position,1);i--;b.parent().parent().remove();showMessage(58);$("#serial").focus()}
function createInstallEquipments(b){$.post(addressCreateInstallEquipments,b+"&equipments="+elements,function(a){a.state&&(showMessage(a.type),$("#loader-login").fadeOut("fast"),$("#form")[0].reset(),$("#equipments").find("ul").next().remove(),$("button[type='submit']").removeAttr("disabled"),elements=[],$("#refer").multiSelect("refresh"),$("section.content > section > section:nth-child(2) > ul").html(""))},"JSON")}
function validation(){return 0==elements.length?($("#equipments").addClass("error"),!1):!0}
function loadDetails(b){$.post(addressLoadDetails,"id="+b,function(a){if(a.state){$("section.content > section > section:nth-child(2) > ul").html("");$("section.content > section > section:nth-child(2) > ul").html('<li class="title">Point selected</div>');for(var b=0;b<a.equipments.length;b++)$("section.content > section > section:nth-child(2) > ul").append('<li class="content-list">'+a.equipments[b].serial+" - "+a.equipments[b].brand+" "+a.equipments[b].model+" </li>");""!=a.type?showMessage(a.type):
$(".alert").hide();$("#loader-model").hide()}},"JSON")};